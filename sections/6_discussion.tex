\section{Discussion}

We have built on our previous work to predict thrombolysis use from patient characteristics, by creating an \emph{explainable machine learning model} which maintains the high accuracy that we previously achieved (85\%). The model was well-calibrated, with the average predicted probability of thrombolysis for any group of patients matching the proportion of those patients who did receive thrombolysis. The SSNAP registry data used therefore appears to contain most of the information used to make thrombolysis decisions in clinical practice. \kpFIXME{[may have to lose this as from the removed subgroup analysis:] To further support this, when we identified a group of patients that the model predicts would receive thrombolysis all the time in the large majority of hospitals, the observed thrombolysis rate of that group was 90\% in half the hospitals}.

We have not designed our model to indicate whether an individual patient \emph{should} receive thrombolysis. Despite our high accuracy, there will be relevant patient details not known to us that would preclude use of thrombolysis. Rather we have used machine learning to determine the usual patterns of use of thrombolysis that are common across hospitals, and vary between hospitals. These learned patterns help identify and show effects of varying patient characteristics.

In general, using SHAP values to uncover the relationship between patient characteristics and the probability of receiving thrombolysis, we found that the probability of receiving thrombolysis fell with increasing arrival-to-scan times, was dependent on stroke severity with the probability of receiving thrombolysis being highest between NIHSS 10 and 25, was lower when onset time was estimated rather than known precisely, and fell sharply with increasing disability prior to stroke. These patterns are similar to the observations of a discrete choice experiment with hypothetical patients \cite{de_brun_factors_2018}, but in our study we confirm these patterns in actual use of thrombolysis, can be quantitative about the effect, and we add the importance of time-to-scan and whether an onset time is known precisely. Using SHAP we can identify the general effect of each patient characteristic, such as stroke severity, and then also whether individual hospitals are influenced to a greater or lesser extent by that characteristic.

Hospital SHAP values correlated very closely with the predicted use of thrombolysis in a 10k cohort of patients, confirming that the hospital SHAP value provides a measure of the predisposition of a hospital to use thrombolysis. We found that hospital identifier (SHAP value) explained 58\% of the variance in observed thrombolysis, suggesting that clinical decision-making around thrombolysis accounts for the majority of variance in use of thrombolysis between hospitals for those patients who arrive at hospital within 4 hours of known (precise or estimated) stroke onset time. 

\iffalse
THIS REFERS TO SUBGROUP ANALYSIS THAT WE REMOVED

After observing the general patterns that exist in the use of thrombolysis, we created subgroups of patients based reflecting what appeared to be an \emph{ideal} candidate for thrombolysis, and also for subgroups where we expected to see lower use of thrombolysis (low stroke severity, no precise onset time, pre-stroke disability). Observed thrombolysis in these groups reflected the patterns identified by the SHAP analysis. For the \emph{ideal} candidates of thrombolysis, half of stroke units would give thrombolysis to at least 90\% of these patients, but some units gave it to significantly fewer patients. Use of thrombolysis in the other subgroups of patients was, as expected, lower, but use also varied significantly, with use ranging between 0\% and 40\% for these less ideal patients. These patterns, both of average use, but also range of use between hospitals, were repeated with expected use of thrombolysis in the same 10k patient cohort of patients.
\fi

Another way of showing variation between units was to use artificial patients. After observing the general patterns that exist in the use of thrombolysis, we created an artificial patient representing an \emph{ideal} candidate for thrombolysis that was predicted to receive thrombolysis at almost every hospital. But when we reduced their stroke severity and attributed an estimated onset time the predicted use of thrombolysis dropped to 35\% of hospitals. With the use of SHAP values it is possible to take the next step into understanding this result by peering into how each hospital responds to the characteristics of this patient, to elucidate where hospitals vary in their attitudes to thrombolysis.

This novel tool examines and understands between-hospital variation in clinical decision making in the acute stroke setting. The application of this tool is not restricted to stroke, or to England and Wales. It can be applied to any clinical decision where there is routinely collected data that quantifies the patients pathway up to the point of the decision, and the features represent a sufficient quantity of the information that clinicians use to make their decision.

The use of mega-datasets such as SSNAP to understand sources of variation in clinical practice between large number of acute stroke centres across the UK presents a unique opportunity to understand the specific influences behind the significant residual between-hospital variation in thrombolysis use.  In particular, it allows national quality improvement projects such as SSNAP to counter one of the most common objections raised to comparative audit: that the patients presenting to any one particular site are in some way unique, thereby accounting for most of the variation in clinical quality between that site and all the others – what, informly, has been termed the `special hospital fallacy'. Although the patient-mix does vary between hospitals, and will contribute to the thrombolysis use achievable by an individual hospital (our previous work identifying the need for individual hospital thrombolysis rate targets of between n and n\%), the majority (58\%) of between-hospital variation is accounted for by hospital-level rather than patient-level factors. \kpFIXME{Check if this sentence can be improved}Another strength of the dataset is its richness. When the observed thrombolysis rate at each hospital is compared to the predicted thrombolysis rate, less than 3\% residual variation remains – suggesting that no more than 3\% of variation in thrombolysis use can be accounted for by factors that are not already measured in the national registry, it contains the data that is needed for thrombolysis decisions. \kpFIXME{[may have to lose this as from the removed subgroup analysis:] A far greater proportion of variation in clinical practice is accounted for by the hospital/team’s own approach to non-ideal features in patients presenting with acute ischaemic stroke – principally stroke severity (a disposition to avoid thrombolysis in patients outside the NIHSS range 10-25), an estimated rather than a precisely-reported onset time (an inclination to avoid thrombolysis unless all the timings are precisely known), and pre-stroke disability (a tendency to avoid thrombolysis in patients already needing at least the help of another person with ordinary daily activities)}. It is disappointing that even though this disability-saving treatment was first licensed for approval for use over 20 years ago, it is still subject to such large 7-fold variation in clinical judgement or opinion regarding the selection of patients most appropriate for use. In our previous publication \cite{allen_using_2022}, we have shown that increasing the uptake of thrombolysis through the administration of treatment to more patients and sooner after stroke, offers the prospect of more than doubling the proportion of patients after stroke who are left with little or no disability (mRS 0 or 1). At a time when there is an appropriate focus of effort on expanding the use of endovascular therapy in acute ischaemic stroke, it is sobering to consider how much population benefit there still remains to accrue from the fullest possible implementation of a cheaper technology that has been available for over 20 years. Far greater scrutiny of such residual variation in clinical practice is clearly warranted, given the extent to which it appears to be acting as a barrier to successful implementation. Recent studies have highlighted that clinicians can be reluctant to modify their behaviour in response to audit and feedback when it is not seen to be clinically meaningful, recent or reliable \cite{bekker_give_2022}, so the full potential of audit and feedback is not realised \cite{foy_revitalising_2020} despite the evidence of a beneficial effect especially when baseline performance is low \cite{ivers_audit_2012}. The development of bespoke, individualised feedback (at least at hospital level) based on actual and recent activity may increase the impact of efforts at data-driven quality improvement targeted at increasing overall uptake of thrombolysis through reducing variation.

%EXTRA DISCUSSION WORDS
%We have shown a novel tool to examine and understand between-hospital variation in clinical decision making in the actue stroke setting. The application of this tool is not restricted to stroke, or the UK. It can be applied to any clinical decision where there is routinely collected data that quantifies the patients pathway up to the point of the decision, and represents a sufficient quantity of the information that the clinicians use.

%Strength: Diversity of patients, dataset size
%Moving on from previous work, improved models explanability whilst maintaining model accuracy.

\subsection{Limitations}

This machine learning study is necessarily limited to data collected for the national stroke audit. Though we have high accuracy, and can identify clear patterns of use of thrombolysis, the data will not be sufficient to provide a decision-support tool. Nor is it a causal model. We may also be missing information that could otherwise have improved the accuracy still further. We also necessarily analyse thrombolysis at hospital level rather than at the level of the individual clinician. The model has high accuracy and can identify clear patterns, suggesting the capability to identify and characterise a centre's culture in the use of thrombolysis, but we do not identify variation in thrombolysis between individual clinicians in the same hospital.

SHAP is a popular method for explaining the output of machine learning models, but it does have some limitations. SHAP values are an approximation of the Shapley values, from which they are based, in order to calculate them efficiently. Even so, SHAP can be computationally expensive and slow for large datasets and complex models. SHAP can only help to explain the fitted model, and so it can only as good as the model (with caveats around training data containing bias, or incomplete information). Another limitation is the interpretation of SHAP values, main effect and interactions can be challenging. To aid our dissemination of the findings from SHAP we have engaged with clinicians, patients and carers to learn how best to communicate this information. SHAP assumes that each feature's contribution is independent of the presence or absence of other features as SHAP values may not accurately capture the true contribution of each feature to the model output if feature independence is not held. We ensured that very little covariance existed between the 10 features that were included in the models. To address this limitation for models where this is not possible, researchers are exploring new methods that can better capture feature interactions and dependencies, such as integrated gradients and DeepLIFT.

We acknowledge that not all countries have a national stroke audit dataset, however we hope that this paper helps to demonstrate what type of analysis can be done should resources be allocated to collect their national data.